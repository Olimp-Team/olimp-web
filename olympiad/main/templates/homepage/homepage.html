{% extends 'base_olimp.html' %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"/>

<div class="p-6 bg-white shadow rounded-lg mb-6">
    <h2 class="text-xl font-bold mb-4">Информация о вас</h2>
    <div class="flex items-center">
        <div class="relative">
            <img class="w-24 h-24 rounded-full border-2 border-gray-300" src="{% static 'homepage/img/Base.png' %}" alt="">
            <img class="w-24 h-24 rounded-full absolute top-0 left-0" src="{% if user.image %}{{ user.image.url }}{% else %}{% static 'homepage/img/default-ava.png' %}{% endif %}" alt="">
        </div>
        <div class="ml-4">
            <p class="text-lg font-semibold">{{ user.last_name }} {{ user.first_name }} {{ user.surname }}</p>
            {% if user.is_child %}
                <p class="text-gray-600">Класс: {{ user.classroom.number }}{{ user.classroom.letter }}</p>
            {% endif %}
            {% if user.is_teacher %}
                <p class="text-gray-600">Классный руководитель: {{ user.classroom_guide.number }}{{ user.classroom_guide.letter }} класса</p>
            {% endif %}
            {% if user.is_admin %}
                <p class="text-gray-600">Администратор системы</p>
            {% endif %}
        </div>
    </div>
</div>

<div class="bg-white shadow rounded-lg p-6 mb-6">
    <h2 class="text-xl font-bold mb-4">Расписание ближайших олимпиад</h2>
    <div class="flex justify-between items-center mb-4">
        <p class="text-gray-600 current-date"></p>
        <div class="flex space-x-2">
            <button id="prev" class="focus:outline-none">
                <img src="{% static 'homepage/img/Group289724.png' %}" alt="Previous">
            </button>
            <button id="next" class="focus:outline-none">
                <img src="{% static 'homepage/img/Group289723.png' %}" alt="Next">
            </button>
        </div>
    </div>
    <div class="calendar">
        <ul class="flex justify-between grid grid-cols-7 gap-1 mb-8 text-center text-gray-600 text-xl font-medium">
            <li class="">Пн</li>
            <li class="">Вт</li>
            <li class="">Ср</li>
            <li class="">Чт</li>
            <li class="">Пт</li>
            <li class="text-red-500">Сб</li>
            <li class="text-red-500">Вс</li>
        </ul>
        <ul class=""><li class="grid grid-cols-7 gap-1 text-center days"></li></ul>
    </div>
</div>

<div class="bg-white shadow rounded-lg p-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Недавние результаты</h2>
        {% if user.is_child or user.is_teacher %}
            <a href="{% url 'result:student_results' %}" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Показать все</a>
        {% else %}
            <a href="{% url 'docs:dashboard' %}" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Показать все</a>
        {% endif %}
    </div>
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white divide-y divide-gray-200">
            <thead>
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Олимпиада</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Баллы</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Статус</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for result in recent_results %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ result.info_olympiad.name }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ result.points }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ result.get_status_result_display }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ result.date_added }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const monthNames = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
        const daysContainer = document.querySelector('.days');
        const currentDate = document.querySelector('.current-date');
        const prevNextIcons = document.querySelectorAll('.icons span');

        let date = new Date(),
            currYear = date.getFullYear(),
            currMonth = date.getMonth();

        const renderCalendar = () => {
            let firstDayOfMonth = new Date(currYear, currMonth, 1).getDay(),
                lastDateOfMonth = new Date(currYear, currMonth + 1, 0).getDate(),
                lastDayOfMonth = new Date(currYear, currMonth, lastDateOfMonth).getDay(),
                lastDateOfLastMonth = new Date(currYear, currMonth, 0).getDate();

            let liTag = "";

            for (let i = firstDayOfMonth; i > 0; i--) {
                liTag += `<li class="text-gray-400">${lastDateOfLastMonth - i + 1}</li>`;
            }

            for (let i = 1; i <= lastDateOfMonth; i++) {
                let isToday = i === date.getDate() && currMonth === new Date().getMonth() && currYear === new Date().getFullYear() ? "bg-blue-500 text-white rounded-full" : "";
                liTag += `<li class="cursor-pointer hover:bg-blue-100 ${isToday}">${i}</li>`;
            }

            for (let i = lastDayOfMonth; i < 6; i++) {
                liTag += `<li class="text-gray-400">${i - lastDayOfMonth + 1}</li>`;
            }

            currentDate.innerText = `${monthNames[currMonth]} ${currYear}`;
            daysContainer.innerHTML = liTag;
        }

        renderCalendar();

        prevNextIcons.forEach(icon => {
            icon.addEventListener("click", () => {
                currMonth = icon.id === "prev" ? currMonth - 1 : currMonth + 1;

                if (currMonth < 0 || currMonth > 11) {
                    date = new Date(currYear, currMonth);
                    currYear = date.getFullYear();
                    currMonth = date.getMonth();
                } else {
                    date = new Date();
                }

                renderCalendar();
            });
        });
    });
</script>

{% endblock %}
